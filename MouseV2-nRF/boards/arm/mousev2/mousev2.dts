// Copyright (c) 2021 Nordic Semiconductor ASA
// SPDX-License-Identifier: Apache-2.0

/dts-v1/;
#include <nordic/nrf52832_qfaa.dtsi>

/ {
	model = "MouseV2";
	compatible = "taras-radchenko,mousev2";

	chosen {
		zephyr,sram = &sram0;
		zephyr,flash = &flash0;
		zephyr,code-partition = &slot0_partition;
	};

	leds {
		compatible = "gpio-leds";
		led_green: led_green {
			gpios = <&gpio0 9 GPIO_ACTIVE_HIGH>;
			label = "Green LED";
		};
		led_red: led_red {
			gpios = <&gpio0 10 GPIO_ACTIVE_HIGH>;
			label = "Red LED";
		};
	};

	buttons {
		compatible = "gpio-keys";

		/* Main buttons */
		button_l: button_l {
			gpios = <&gpio0 30 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Left button";
		};
		button_r: button_r {
			gpios = <&gpio0 29 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Right button";
		};
		button_m: button_m {
			gpios = <&gpio0 31 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Middle button";
		};
		button_spec: button_spec {
			gpios = <&gpio0 28 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Special button";
		};
		button_mode: button_mode {
			gpios = <&gpio0 21 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Mode button";
		};

		/* Thumb buttons */
		button_center: button_center {
			gpios = <&gpio0 26 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Center button";
		};
		button_up: button_up {
			gpios = <&gpio0 25 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Up button";
		};
		button_down: button_down {
			gpios = <&gpio0 23 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Down button";
		};
		button_fwd: button_fwd {
			gpios = <&gpio0 27 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Forward button";
		};
		button_bwd: button_bwd {
			gpios = <&gpio0 24 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;
			label = "Backward button";
		};
	};

	vbatt {
		compatible = "voltage-divider";
		io-channels = <&adc 0>;
		output-ohms = <2000000>;
		full-ohms = <3000000>;
	};

	vdd_pwr: vdd-switch {
		compatible = "regulator-fixed-sync", "regulator-fixed";
		label = "VDD switch";
		regulator-name = "vdd-switch";
		enable-gpios = <&gpio0 22 GPIO_ACTIVE_LOW>;
		startup-delay-us = <100>;
		regulator-boot-on;
	};
};

&gpiote {
	status = "okay";
};

&gpio0 {
	status = "okay";
};

&adc {
	status = "okay";
};

&qdec {
	status = "okay";
	a-pin = <14>;
	b-pin = <12>;
	// value from sensor is returned in degrees, so make one step equal to one degree to get actual steps
	steps = <360>;
	led-pre = <0>;
};

&spi0 {
	status = "okay";
	compatible = "nordic,nrf-spi";
	sck-pin = <15>;
	miso-pin = <17>;
	mosi-pin = <18>;
	cs-gpios = <&gpio0 20 GPIO_ACTIVE_LOW>, <&gpio0 11 GPIO_ACTIVE_LOW>;  // ADNS (20), AVR(11)

	adns7530@0 {
		compatible = "pixart,adns7530";
		reg = <0>;
		mot-gpios = <&gpio0 19 GPIO_ACTIVE_LOW>;
		spi-max-frequency = <1000000>;
		label = "ADNS-7530";
		vin-supply = <&vdd_pwr>;
	};
};

&flash0 {
	partitions {
		compatible = "fixed-partitions";
		#address-cells = <1>;
		#size-cells = <1>;

		boot_partition: partition@0 {
			label = "mcuboot";
			reg = <0x0 0xc000>;
		};
		slot0_partition: partition@c000 {
			label = "image-0";
			reg = <0xc000 0x32000>;
		};
		slot1_partition: partition@3e000 {
			label = "image-1";
			reg = <0x3e000 0x32000>;
		};
		scratch_partition: partition@70000 {
			label = "image-scratch";
			reg = <0x70000 0xa000>;
		};
		storage_partition: partition@7a000 {
			label = "storage";
			reg = <0x7a000 0x6000>;
		};
	};
};
